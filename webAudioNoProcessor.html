<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>webAudioNoProcessor</title>
</head>
<body>
    <script src="addNavigationavBar.js"></script>

    <h1> Web Audio WITHOUT Extending AudioWorkletProcessor (not using process()) </h1>

    <button onclick="loadAndPlayAudio(0)">Play String 1</button>
    <button onclick="loadAndPlayAudio(1)">Play String 2</button>
    <button onclick="loadAndPlayAudio(2)">Play String 3</button>
    <button onclick="loadAndPlayAudio(3)">Play String 4</button>
    <button onclick="loadAndPlayAudio(-1)">Play All</button>

    <button id="noteOnButton">Play All (down+touch)</button>

    <script>
        // Create an AudioContext
        var audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        // Array to hold the decoded audio buffers
        var audioBuffers = [];
        
        // Array of audio file URLs
        var audioFiles = [
            'samples/C_Down.wav',
            'samples/E_Down.wav',
            'samples/G_Down.wav',
            'samples/A_Down.wav'
        ];
        
        //%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        // Function to load audio files
        function loadAudioFiles() {
            audioFiles.forEach((file, index) => {
                fetch(file)
                    .then(response => response.arrayBuffer())
                    .then(arrayBuffer => audioContext.decodeAudioData(arrayBuffer))
                    .then(decodedData => { audioBuffers[index] = decodedData; })
                    .catch(error => console.error('Error loading audio file:', error));
            });
        }

        loadAudioFiles();
        //window.onload = loadAudioFiles;

        //%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        // Function to play audio from the buffers
        function loadAndPlayAudio(index) {
            if (index < 0) {
                for (let i = 0; i < audioBuffers.length; i++) {
                    if (audioBuffers[i]) {
                        var source = audioContext.createBufferSource();
                        source.buffer = audioBuffers[i];
                        source.connect(audioContext.destination);
                        source.start(0);
                    }
                    else {
                        console.log('Audio file not loaded yet.');
                    }
                }
            }
            else {
                if (audioBuffers[index]) {
                    var source = audioContext.createBufferSource();
                    source.buffer = audioBuffers[index];
                    source.connect(audioContext.destination);
                    source.start(0);
                } else {
                    console.log('Audio file not loaded yet.');
                }
            }
        }

        //%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

        document.getElementById('noteOnButton').addEventListener('mousedown',  function(event) {
            loadAndPlayAudio(-1);
        });
        document.getElementById('noteOnButton').addEventListener('touchstart', function(event) {
            event.preventDefault(); // Prevent the default touch behavior to avoid triggering `click` or other unintended events
            loadAndPlayAudio(-1);
        });
    </script>
</body>
</html>
